<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="darkreader-lock" />
  <meta name="color-scheme" content="light dark" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self'; worker-src 'self' blob:; child-src 'self' blob:;">
  <title>NeuroViz - Neural Network Visualiser</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;700&display=swap"
    rel="stylesheet" />
  <!-- Critical CSS inline to prevent FOUC -->
  <style>
    /* CSS Variables must be duplicated here for FOUC prevention */
    :root {
      --color-bg-primary-rgb: 10, 14, 26;
      --color-text-primary-rgb: 241, 245, 249;
    }

    html:not(.dark) {
      --color-bg-primary-rgb: 248, 250, 252;
      --color-text-primary-rgb: 15, 23, 42;
    }

    /* Base theme colours applied immediately using CSS variables */
    html.dark body {
      background: rgb(var(--color-bg-primary-rgb));
      color: rgb(var(--color-text-primary-rgb));
    }

    html:not(.dark) body {
      background: rgb(var(--color-bg-primary-rgb));
      color: rgb(var(--color-text-primary-rgb));
    }

    /* Hide content until styles load */
    .app-container {
      opacity: 0;
      transition: opacity 0.15s ease-in;
    }

    .app-container.loaded {
      opacity: 1;
    }
  </style>

</head>

<body>
  <!-- Live Region for Screen Reader Announcements -->
  <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <div class="app-container" role="application" aria-label="NeuroViz Neural Network Trainer">

    <!-- DASHBOARD GRID LAYOUT -->
    <div class="dashboard-grid">

      <!-- HEADER (Row 1, Spans All) -->
      <header style="grid-area: header;"
        class="flex items-center justify-between py-2 px-4 bg-navy-900/80 backdrop-blur-md z-50 border-b border-white/5"
        role="banner">
        <div class="flex items-center gap-2">
          <h1 class="text-lg font-bold text-gradient glow-accent">NeuroViz</h1>
          <span class="text-slate-500 text-xs hidden md:inline">Engineer's Dashboard</span>
        </div>
        <div class="flex items-center gap-1 sm:gap-2">
          <button id="btn-help" class="p-2 rounded-lg bg-navy-800 hover:bg-navy-700 transition-colors"
            aria-label="Help & Tutorials" title="Help & Tutorials">
            <svg class="w-5 h-5 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </button>
          <button id="btn-fullscreen" class="p-2 rounded-lg bg-navy-800 hover:bg-navy-700 transition-colors"
            aria-label="Toggle fullscreen" title="Toggle fullscreen (F)">
            <!-- Expand icon (shown when not fullscreen) -->
            <svg id="icon-expand" class="w-5 h-5 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
            </svg>
            <!-- Compress icon (shown when fullscreen, hidden by default) -->
            <svg id="icon-compress" class="w-5 h-5 text-slate-300 hidden" fill="none" stroke="currentColor"
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l-5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25" />
            </svg>
          </button>
          <!-- Learn Menu Dropdown -->
          <div class="relative" id="learn-menu-container">
            <button id="btn-learn-menu" class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 transition-colors flex items-center gap-2 text-sm font-medium text-white"
              aria-label="Learning resources" title="Tutorials & Challenges">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
              Learn
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div id="learn-menu-dropdown" class="absolute right-0 mt-2 w-56 bg-navy-800 border border-navy-600 rounded-lg shadow-xl hidden z-50">
              <div class="p-2">
                <button id="btn-open-tutorials" class="w-full text-left px-3 py-2 rounded hover:bg-navy-700 text-slate-300 hover:text-white transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                  </svg>
                  Guided Tutorials
                </button>
                <button id="btn-open-challenges" class="w-full text-left px-3 py-2 rounded hover:bg-navy-700 text-slate-300 hover:text-white transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                  </svg>
                  Challenge Mode
                  <span id="challenge-completion-badge" class="ml-auto text-[10px] bg-amber-500/20 text-amber-400 px-1.5 py-0.5 rounded">0/7</span>
                </button>
              </div>
              <div class="border-t border-navy-600 p-2">
                <button id="btn-open-help" class="w-full text-left px-3 py-2 rounded hover:bg-navy-700 text-slate-300 hover:text-white transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  Keyboard Shortcuts
                  <kbd class="ml-auto text-[10px] bg-navy-900 px-1.5 py-0.5 rounded text-slate-500">?</kbd>
                </button>
              </div>
            </div>
          </div>
          <button id="btn-theme-toggle" class="p-2 rounded-lg bg-navy-800 hover:bg-navy-700 transition-colors"
            aria-label="Toggle theme" title="Toggle light/dark theme">
            <!-- Sun icon (shown in dark mode) -->
            <svg id="icon-sun" class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <!-- Moon icon (shown in light mode, hidden by default) -->
            <svg id="icon-moon" class="w-5 h-5 text-slate-600 hidden" fill="none" stroke="currentColor"
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
          </button>
        </div>
      </header>

      <!-- LEFT PANEL (Datasets & Session) -->
      <aside class="panel-left">
        <div class="panel-scroll">

          <!-- Quick Presets -->
          <div class="p-4 bg-navy-800/30 rounded-xl mb-4">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Quick Start</h3>
            <select id="preset-select" aria-label="Select preset configuration" class="select-field mb-2 text-xs">
              <option value="">â€” Select a preset â€”</option>
              <option value="quickDemo">ðŸš€ Quick Demo - Fast & Simple</option>
              <option value="deepNetwork">ðŸŒ€ Deep Network - Complex Patterns</option>
              <option value="highAccuracy">ðŸŽ¯ High Accuracy - Slower but Better</option>
              <option value="overfitDemo">ðŸ“ˆ Overfit Demo - See Overfitting</option>
            </select>
            <div id="preset-description" class="text-[10px] text-slate-400 mb-2 min-h-[2rem] italic leading-tight"></div>
            <button id="btn-apply-preset" class="btn-primary w-full text-xs py-2" disabled>
              Apply Preset
            </button>
          </div>

          <!-- Dataset Section -->
          <div class="p-4 bg-navy-800/30 rounded-xl mb-4">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Dataset</h3>

            <!-- Compact Dataset Grid -->
            <div class="grid grid-cols-2 gap-2 mb-3 dataset-gallery-grid">
              <!-- Simplified Cards (kept IDs related to JS logic if any, though JS mostly uses data attributes) -->
              <div class="dataset-preview-card p-2" data-dataset="circle" title="Circle">
                <div class="dataset-preview-label text-center text-xs">Circle</div>
              </div>
              <div class="dataset-preview-card p-2" data-dataset="xor" title="XOR">
                <div class="dataset-preview-label text-center text-xs">XOR</div>
              </div>
              <div class="dataset-preview-card p-2" data-dataset="spiral" title="Spiral">
                <div class="dataset-preview-label text-center text-xs">Spiral</div>
              </div>
              <div class="dataset-preview-card p-2" data-dataset="gaussian" title="Gaussian">
                <div class="dataset-preview-label text-center text-xs">Gaussian</div>
              </div>
              <div class="dataset-preview-card p-2" data-dataset="clusters" title="Clusters">
                <div class="dataset-preview-label text-center text-xs">Clusters</div>
              </div>
              <div class="dataset-preview-card p-2" data-dataset="iris" title="Iris">
                <div class="dataset-preview-label text-center text-xs">Iris</div>
              </div>
              <div class="dataset-preview-card p-2" data-dataset="wine" title="Wine">
                <div class="dataset-preview-label text-center text-xs">Wine</div>
              </div>
              <div class="dataset-preview-card p-2" data-dataset="custom" title="Custom">
                <div class="dataset-preview-label text-center text-xs">Draw</div>
              </div>
            </div>

            <!-- Hidden Elements required by JS -->
            <div class="dataset-gallery mb-3 hidden"></div>
            <select id="dataset-select" class="hidden">
              <option value="circle">Circle</option>
              <option value="xor">XOR</option>
              <option value="spiral">Spiral</option>
              <option value="gaussian">Gaussian</option>
              <option value="clusters">Clusters</option>
              <option value="iris">Iris</option>
              <option value="wine">Wine</option>
              <option value="custom">Custom</option>
            </select>

            <!-- Dataset Options -->
            <div id="dataset-options" class="space-y-2 mb-3">
              <label class="block">
                <span class="input-label">Samples: <span id="samples-value">200</span></span>
                <input type="range" id="input-samples"
                  class="w-full h-2 bg-navy-700 rounded-lg appearance-none cursor-pointer accent-accent-500" value="200"
                  min="50" max="500" step="50" />
              </label>
              <label class="block">
                <span class="input-label">Noise: <span id="noise-value">0.1</span></span>
                <input type="range" id="input-noise"
                  class="w-full h-2 bg-navy-700 rounded-lg appearance-none cursor-pointer accent-accent-500" value="10"
                  min="0" max="50" step="5" />
              </label>
              <label class="block">
                <span class="input-label">Class Balance: <span id="balance-value">50%</span></span>
                <input type="range" id="input-balance"
                  class="w-full h-2 bg-navy-700 rounded-lg appearance-none cursor-pointer accent-accent-500" value="50"
                  min="10" max="90" step="5" />
              </label>
              <label class="block">
                <span class="input-label">Preprocessing</span>
                <select id="input-preprocessing" class="select-field text-xs">
                  <option value="none" selected>None</option>
                  <option value="normalize">Normalize</option>
                  <option value="standardize">Standardize</option>
                </select>
              </label>
            </div>

            <div class="flex gap-2">
              <button id="btn-load-data" class="btn-secondary flex-1 text-xs">Fetch</button>
              <label class="btn-secondary flex-1 cursor-pointer text-center text-xs pt-1">
                CSV <input type="file" id="input-csv-upload" accept=".csv" class="hidden" />
              </label>
            </div>

            <div id="draw-controls" class="mt-3 hidden">
              <div class="text-xs text-slate-400 mb-2">Click chart to add</div>
              <div id="draw-class-buttons" class="flex flex-wrap gap-2"></div>
              <button id="btn-clear-custom" class="btn-secondary w-full mt-2 text-xs">Clear Points</button>
            </div>

            <!-- Dataset Statistics -->
            <div id="dataset-stats-panel" class="mt-3 p-3 bg-navy-900/50 rounded-lg border border-navy-700 hidden">
              <h4 class="text-[10px] font-bold text-cyan-400 uppercase tracking-wider mb-2 flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                Dataset Stats
              </h4>
              <div id="dataset-stats-content" class="text-[10px] text-slate-400 space-y-1">
                <div class="flex justify-between">
                  <span>Total Samples:</span>
                  <span id="stats-total" class="text-slate-300 font-mono">â€”</span>
                </div>
                <div id="stats-classes" class="space-y-0.5 mt-2">
                  <!-- Class distribution populated dynamically -->
                </div>
                <div id="stats-outliers" class="mt-2 text-[9px] text-amber-400 hidden">
                  âš  <span id="stats-outliers-count">0</span> outliers detected
                </div>
              </div>
            </div>
          </div>

          <!-- Session Management -->
          <div class="p-4 bg-navy-800/30 rounded-xl mb-4">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Session</h3>
            <div class="flex gap-2 mb-2">
              <button id="btn-save-session" class="btn-secondary flex-1 text-xs">Save</button>
              <button id="btn-load-session" class="btn-secondary flex-1 text-xs">Load</button>
            </div>
            <div class="flex gap-2">
              <button id="btn-share-url" class="btn-secondary flex-1 text-xs">Copy</button>
              <button id="btn-load-config" class="btn-secondary flex-1 text-xs">Paste</button>
            </div>
          </div>

        </div>
      </aside>

      <!-- CENTER PANEL (Viz & History) -->
      <main class="panel-center">
        <!-- Status Header -->
        <div class="flex items-center justify-between mb-4 bg-navy-900/50 p-2 rounded-lg border border-white/5">
          <div class="flex gap-4">
            <div>
              <span class="text-[10px] text-slate-500 uppercase">Epoch</span>
              <div id="status-epoch" class="text-xl font-bold text-accent-400 tabular-nums leading-none">0</div>
            </div>
            <div>
              <span class="text-[10px] text-slate-500 uppercase">Loss</span>
              <div id="status-loss" class="text-xl font-mono font-bold text-orange-400 tabular-nums leading-none">â€”
              </div>
            </div>
            <div>
              <span class="text-[10px] text-slate-500 uppercase">Accuracy</span>
              <div id="status-accuracy" class="text-xl font-mono font-bold text-emerald-400 tabular-nums leading-none">â€”
              </div>
            </div>
          </div>
          <!-- Playback Controls -->
          <div class="flex gap-2">
            <button id="btn-reset"
              class="px-3 py-2 rounded bg-red-900/20 hover:bg-red-900/40 border border-red-900/30 hover:border-red-900/50 text-red-400 hover:text-red-300 font-medium text-xs transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
              title="Reset Training (R)" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              Start Over
            </button>
            <button id="btn-step" class="p-2 rounded hover:bg-navy-700 text-slate-300 transition-colors"
              title="Step (S)" disabled>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
              </svg>
            </button>
            <button id="btn-start"
              class="px-4 py-2 rounded bg-gradient-cyan hover:shadow-glow-cyan text-white font-semibold text-xs flex items-center gap-2 transition-all shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
              title="Start/Pause (Space)" disabled>
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z" />
              </svg>
              Start Training
            </button>
            <button id="btn-pause"
              class="px-4 py-2 rounded bg-navy-700 hover:bg-navy-600 text-slate-300 font-medium text-xs hidden flex items-center gap-2 transition-colors"
              title="Start/Pause (Space)">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
              </svg>
              Pause
            </button>
            <div class="flex gap-1 ml-auto">
              <button id="btn-undo-config" class="p-2 rounded hover:bg-navy-700 text-slate-400 hover:text-slate-300 transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
                title="Undo Config (Ctrl+Z)" disabled>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                </svg>
              </button>
              <button id="btn-redo-config" class="p-2 rounded hover:bg-navy-700 text-slate-400 hover:text-slate-300 transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
                title="Redo Config (Ctrl+Y)" disabled>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Visualization Area -->
        <section id="viz-panel" class="panel-glow relative flex-1 mb-4 flex flex-col"
          aria-label="Neural network visualization">
          <div id="viz-container" role="img" class="flex-1 w-full h-full min-h-0"
            aria-label="Neural network decision boundary visualization">
            <!-- D3 chart renders here -->
            <div id="viz-empty-state"
              class="empty-state-cta absolute inset-0 flex items-center justify-center flex-col pointer-events-none">
              <div class="text-slate-500 mb-2">Ready to Initialize</div>
              <div class="text-xs text-slate-600">Select data and config to begin</div>
            </div>
          </div>

          <!-- Overlays -->
          <div id="loading-overlay"
            class="loading-overlay hidden absolute inset-0 bg-navy-900/80 flex items-center justify-center z-20">
            <div class="spinner"></div>
          </div>

          <!-- 3D View Container (hidden by default) -->
          <div id="three-container" class="absolute inset-0 hidden z-10"></div>
          
          <!-- Footer Controls for Viz (z-30 to be above 3D view, bottom-10 to clear X-axis) -->
          <div class="absolute bottom-10 left-4 right-4 flex justify-between pointer-events-none z-30">
            <!-- Left: Metric Cards Overlay -->
            <div class="flex gap-2 pointer-events-auto">
              <div class="bg-navy-900/80 backdrop-blur p-2 rounded border border-white/10 text-xs shadow-lg">
                <span class="text-slate-500 block">Val Loss</span>
                <span id="status-val-loss" class="text-red-400 font-mono font-bold">â€”</span>
              </div>
            </div>
            <!-- Right: View Controls (Toggle Switches) -->
            <div
              class="flex gap-4 pointer-events-auto bg-navy-900/80 backdrop-blur p-2 rounded-lg border border-white/10 shadow-lg items-center">
              <label
                class="flex items-center gap-2 text-[10px] text-slate-300 cursor-pointer hover:text-white transition-colors group">
                <input type="checkbox" id="input-show-gradients" class="toggle-switch" />
                <span class="font-medium group-hover:text-cyan transition-colors">Weights</span>
              </label>
              <div class="w-px h-4 bg-white/10"></div>
              <label
                class="flex items-center gap-2 text-[10px] text-slate-300 cursor-pointer hover:text-white transition-colors group">
                <input type="checkbox" id="input-voronoi" class="toggle-switch" />
                <span class="font-medium group-hover:text-cyan transition-colors">Voronoi</span>
              </label>
              <div class="w-px h-4 bg-white/10"></div>
              <label
                class="flex items-center gap-2 text-[10px] text-slate-300 cursor-pointer hover:text-white transition-colors group">
                <input type="checkbox" id="input-3d-view" class="toggle-switch" />
                <span class="font-medium group-hover:text-cyan transition-colors">3D Mode</span>
              </label>
            </div>
          </div>
          
          <!-- Gradient Flow Container (hidden by default) -->
          <div id="gradient-flow-container" class="absolute bottom-14 left-4 w-64 bg-navy-900/90 rounded-lg border border-white/10 hidden z-40 p-2">
            <h4 class="text-[10px] font-bold text-slate-400 uppercase mb-1">Weight Changes</h4>
            <div id="gradient-flow-chart" class="w-full" style="height: 140px;"></div>
          </div>
        </section>

        <!-- Learning Rate Timeline -->
        <div class="h-[100px] bg-navy-900/30 rounded-xl border border-white/5 relative flex flex-col overflow-hidden transition-all duration-300 hover:border-white/10 mt-4">
          <div class="flex items-center justify-between px-3 py-1 border-b border-white/5 bg-navy-900/40 shrink-0">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
              <svg class="w-3 h-3 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              Learning Rate
            </h3>
          </div>
          <div id="lr-chart-container" class="flex-1 w-full relative"></div>
        </div>

        <!-- Loss & Accuracy Timeline -->
        <div
          class="h-[180px] bg-navy-900/30 rounded-xl border border-white/5 relative flex flex-col overflow-hidden transition-all duration-300 hover:border-white/10 mt-4">
          <div class="flex items-center justify-between px-3 py-1.5 border-b border-white/5 bg-navy-900/40 shrink-0">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
              <svg class="w-3 h-3 text-cyan" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
              </svg>
              Training History
            </h3>
            <div class="flex gap-4 text-[10px] text-slate-500">
              <span class="flex items-center gap-1">Best Loss: <span id="stat-best-loss"
                  class="text-orange-400 font-mono font-bold">â€”</span></span>
              <span class="flex items-center gap-1">Best Acc: <span id="stat-best-accuracy"
                  class="text-emerald-400 font-mono font-bold">â€”</span></span>
              <span class="flex items-center gap-1">Improvement: <span id="stat-improvement"
                  class="text-accent-400 font-mono font-bold">â€”</span></span>
            </div>
          </div>
          <div id="loss-chart-container" class="flex-1 w-full min-h-0 overflow-hidden">
            <!-- D3 Chart -->
            <div id="loss-chart-empty" class="absolute inset-0 flex items-center justify-center text-slate-700 text-xs">
              No history data
            </div>
          </div>
        </div>

      </main>

      <!-- RIGHT PANEL (Hyperparameters) -->
      <aside class="panel-right">
        <div class="panel-scroll">

          <!-- Hyperparameters -->
          <div class="p-4 bg-navy-800/30 rounded-xl mb-4">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Hyperparameters</h3>
            <div class="space-y-3">
              <div class="grid grid-cols-2 gap-2">
                <label class="block">
                  <span class="input-label">Learning Rate</span>
                  <input type="number" id="input-lr" class="input-field text-xs" value="0.03" min="0.001" max="1"
                    step="0.001" />
                </label>
                <label class="block">
                  <span class="input-label">Optimizer</span>
                  <select id="input-optimizer" class="select-field text-xs">
                    <option value="adam" selected>Adam</option>
                    <option value="sgd">SGD</option>
                    <option value="rmsprop">RMSprop</option>
                  </select>
                </label>
              </div>
              <div class="grid grid-cols-2 gap-2">
                <label class="block">
                  <span class="input-label">Loss Function</span>
                  <select id="input-loss-function" class="select-field text-xs">
                    <option value="crossEntropy" selected>Cross Entropy</option>
                    <option value="mse">MSE</option>
                    <option value="hinge">Hinge</option>
                  </select>
                </label>
                <label class="flex items-center gap-2 mt-4">
                  <input type="checkbox" id="input-batch-norm" class="w-4 h-4 rounded border-slate-600 bg-navy-900 text-cyan-500 focus:ring-cyan-500" />
                  <span class="input-label">Batch Norm</span>
                </label>
              </div>
              <label class="block">
                <span class="input-label">Hidden Layers</span>
                <input type="text" id="input-layers" class="input-field text-xs" value="8, 4"
                  placeholder="e.g., 8, 4" />
              </label>
              <div class="grid grid-cols-2 gap-2">
                <label class="block">
                  <span class="input-label">Activation</span>
                  <select id="input-activation" class="select-field text-xs">
                    <option value="relu" selected>ReLU</option>
                    <option value="tanh">Tanh</option>
                    <option value="sigmoid">Sigmoid</option>
                  </select>
                </label>
                <label class="block">
                  <span class="input-label">Output</span>
                  <select id="input-num-classes" class="select-field text-xs">
                    <option value="2">Binary</option>
                    <option value="3">3 Class</option>
                    <option value="4">4 Class</option>
                  </select>
                </label>
              </div>

              <button id="btn-init" class="btn-primary w-full text-xs">Initialise Network</button>
            </div>
          </div>

          <!-- Training Config -->
          <div class="p-4 bg-navy-800/30 rounded-xl mb-4">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Training Config</h3>
            <div class="grid grid-cols-2 gap-2 mb-2">
              <label class="block">
                <span class="input-label">Batch Size</span>
                <input type="number" id="input-batch-size" class="input-field text-xs" value="10" />
              </label>
              <label class="block">
                <span class="input-label">Max Epochs</span>
                <input type="number" id="input-max-epochs" class="input-field text-xs" value="100" />
              </label>
            </div>
            <label class="flex items-center gap-2 mb-2">
              <input type="checkbox" id="input-batch-norm" class="checkbox-field" />
              <span class="text-xs text-slate-400">Batch Normalization</span>
            </label>
            <label class="block mb-2">
              <span class="input-label">Speed (FPS): <span id="fps-value">60</span></span>
              <input type="range" id="input-fps" class="w-full h-1 accent-accent-500" value="60" min="1" max="60" />
            </label>
            <label class="block mb-2">
              <span class="input-label">Performance Mode</span>
              <select id="input-perf-mode" class="select-field text-xs">
                <option value="full" selected>Full Speed (60 FPS)</option>
                <option value="balanced">Balanced (30 FPS)</option>
                <option value="battery">Battery Saver (15 FPS)</option>
              </select>
            </label>
            <label class="block mb-2">
              <span class="input-label">LR Schedule</span>
              <select id="input-lr-schedule" class="select-field text-xs">
                <option value="none" selected>None (Constant)</option>
                <option value="step">Step Decay</option>
                <option value="exponential">Exponential Decay</option>
                <option value="cosine">Cosine Annealing</option>
              </select>
            </label>
            <label class="block">
              <span class="input-label">Validation Split</span>
              <select id="input-val-split" class="select-field text-xs">
                <option value="0">0% (No Validation)</option>
                <option value="10">10%</option>
                <option value="20" selected>20%</option>
                <option value="30">30%</option>
                <option value="40">40%</option>
                <option value="50">50%</option>
              </select>
            </label>
          </div>

          <!-- Advanced/Research Accordion -->
          <div class="space-y-2">
            <!-- Regularization -->
            <details class="group bg-navy-800/30 rounded-lg p-2">
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Regularization <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div class="grid grid-cols-2 gap-2 mt-2">
                <label><span class="text-[10px] text-slate-500">L1</span> <input type="number" id="input-l1"
                    class="input-field text-xs" value="0" /></label>
                <label><span class="text-[10px] text-slate-500">L2</span> <input type="number" id="input-l2"
                    class="input-field text-xs" value="0" /></label>
                <label><span class="text-[10px] text-slate-500">Dropout</span> <select id="input-dropout"
                    class="select-field text-xs">
                    <option value="0">0%</option>
                    <option value="0.2">20%</option>
                    <option value="0.5">50%</option>
                  </select></label>
              </div>
            </details>

            <!-- Network Architecture Diagram -->
            <details class="group bg-navy-800/30 rounded-lg p-2" open>
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Network Diagram <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div id="network-diagram" class="mt-2 min-h-[120px]"></div>
            </details>

            <!-- Weight Distribution -->
            <details class="group bg-navy-800/30 rounded-lg p-2">
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Weight Distribution <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div id="weight-histogram" class="mt-2 min-h-[80px]"></div>
            </details>

            <!-- Classification Metrics -->
            <details class="group bg-navy-800/30 rounded-lg p-2">
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Confusion Matrix <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div id="confusion-matrix-container" class="mt-2 min-h-[60px] flex justify-center"></div>
              <div class="grid grid-cols-3 gap-1 mt-1 text-center">
                <div class="p-1 bg-navy-900 rounded">
                  <div class="text-[10px] text-slate-500">F1</div>
                  <div id="metric-f1" class="text-xs text-pink-400">â€”</div>
                </div>
                <div class="p-1 bg-navy-900 rounded">
                  <div class="text-[10px] text-slate-500">Prec</div>
                  <div id="metric-precision" class="text-xs text-blue-400">â€”</div>
                </div>
                <div class="p-1 bg-navy-900 rounded">
                  <div class="text-[10px] text-slate-500">Rec</div>
                  <div id="metric-recall" class="text-xs text-purple-400">â€”</div>
                </div>
              </div>
            </details>

            <!-- Activation Histograms -->
            <details class="group bg-navy-800/30 rounded-lg p-2">
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Layer Activations <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div id="activation-histogram" class="mt-2 min-h-[120px]"></div>
            </details>

            <!-- Model Complexity Metrics -->
            <details class="group bg-navy-800/30 rounded-lg p-2" open>
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Model Complexity <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div id="model-complexity-panel" class="mt-2 space-y-2">
                <div class="grid grid-cols-2 gap-2 text-[10px]">
                  <div class="p-2 bg-navy-900/50 rounded">
                    <div class="text-slate-500">Parameters</div>
                    <div id="complexity-params" class="text-lg font-bold text-cyan-400">â€”</div>
                  </div>
                  <div class="p-2 bg-navy-900/50 rounded">
                    <div class="text-slate-500">FLOPs/Forward</div>
                    <div id="complexity-flops" class="text-lg font-bold text-emerald-400">â€”</div>
                  </div>
                </div>
                <div class="p-2 bg-navy-900/50 rounded text-[10px]">
                  <div class="flex justify-between">
                    <span class="text-slate-500">Memory (Params)</span>
                    <span id="complexity-param-memory" class="text-slate-300">â€”</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-slate-500">Memory (Activations)</span>
                    <span id="complexity-activation-memory" class="text-slate-300">â€”</span>
                  </div>
                  <div class="flex justify-between font-medium">
                    <span class="text-slate-400">Total Memory</span>
                    <span id="complexity-total-memory" class="text-amber-400">â€”</span>
                  </div>
                </div>
                <div id="complexity-rating" class="text-[10px] text-slate-400 italic p-2 bg-navy-900/30 rounded"></div>
              </div>
            </details>

            <!-- Adversarial Examples -->
            <details class="group bg-navy-800/30 rounded-lg p-2">
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Adversarial Examples <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div class="mt-2 space-y-2">
                <p class="text-[10px] text-slate-500">Generate points that fool the model - small perturbations that cause misclassification.</p>

                <!-- Method Selection -->
                <div>
                  <label class="text-[10px] text-slate-400 block mb-1">Attack Method:</label>
                  <select id="adversarial-method" class="w-full px-2 py-1 text-xs bg-navy-900 border border-navy-700 rounded text-slate-200">
                    <option value="simple">Simple (Gradient-Free)</option>
                    <option value="fgsm">FGSM (Gradient-Based)</option>
                  </select>
                  <p class="text-[9px] text-slate-500 mt-0.5" id="adversarial-method-desc">Spiral search pattern, fast but less accurate</p>
                </div>

                <!-- Sample Size -->
                <div>
                  <label class="text-[10px] text-slate-400 block mb-1">
                    Sample Size: <span id="adversarial-sample-value" class="text-emerald-400 font-mono">20</span>
                  </label>
                  <input type="range" id="adversarial-sample-size" min="5" max="100" value="20" step="5"
                         class="w-full h-1 bg-navy-700 rounded-lg appearance-none cursor-pointer">
                  <div class="flex justify-between text-[9px] text-slate-500">
                    <span>5</span>
                    <span>100</span>
                  </div>
                </div>

                <!-- Progress Indicator -->
                <div id="adversarial-progress" class="hidden">
                  <div class="flex justify-between text-[10px] mb-1">
                    <span class="text-slate-400" id="adversarial-progress-text">Generating...</span>
                    <span id="adversarial-progress-count" class="text-emerald-400 font-mono">0/0</span>
                  </div>
                  <div class="w-full bg-navy-700 rounded-full h-1.5">
                    <div id="adversarial-progress-bar" class="bg-gradient-to-r from-amber-500 to-orange-500 h-1.5 rounded-full transition-all" style="width: 0%"></div>
                  </div>
                </div>

                <button id="btn-generate-adversarial" class="btn-secondary w-full text-xs py-1.5" disabled>
                  Generate Adversarial Examples
                </button>

                <div id="adversarial-results" class="hidden">
                  <div class="flex justify-between text-[10px] mb-1">
                    <span class="text-slate-400">Found:</span>
                    <span id="adversarial-count" class="text-amber-400 font-bold">0</span>
                  </div>
                  <div id="adversarial-list" class="max-h-24 overflow-y-auto space-y-1 text-[10px]">
                    <!-- Adversarial examples listed here -->
                  </div>
                  <button id="btn-clear-adversarial" class="btn-secondary w-full text-[10px] py-1 mt-2">
                    Clear Adversarial Points
                  </button>
                </div>
              </div>
            </details>

            <!-- Speed Comparison -->
            <details class="group bg-navy-800/30 rounded-lg p-2">
              <summary class="text-xs font-bold text-slate-400 cursor-pointer list-none flex justify-between">
                Training Speed <span class="group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <div class="mt-2 space-y-2">
                <div class="text-[10px] text-slate-400">
                  <div class="flex justify-between">
                    <span>Current:</span>
                    <span id="speed-current" class="text-emerald-400 font-mono">â€”</span>
                  </div>
                  <div id="speed-comparison-container" class="mt-2 hidden">
                    <div class="flex justify-between">
                      <span>Baseline:</span>
                      <span id="speed-baseline" class="text-slate-500 font-mono">â€”</span>
                    </div>
                    <div class="mt-1 text-center">
                      <span id="speed-comparison-result" class="text-xs font-bold text-cyan-400">â€”</span>
                    </div>
                  </div>
                </div>
                <div class="flex gap-1">
                  <button id="btn-save-speed-baseline" class="btn-secondary text-[10px] py-1 flex-1">Save Baseline</button>
                  <button id="btn-clear-speed-baseline" class="btn-secondary text-[10px] py-1 flex-1 hidden">Clear</button>
                </div>
              </div>
            </details>
          </div>

          <!-- Export Tools -->
          <div class="mt-4 pt-4 border-t border-white/5">
            <div class="grid grid-cols-2 gap-2 mb-2">
              <button id="btn-export-model-sticky" class="btn-secondary text-xs">Export Model</button>
              <button id="btn-export-history-sticky" class="btn-secondary text-xs">Export Stats</button>
            </div>
            <button id="btn-export-report" class="btn-primary w-full text-xs py-2 flex items-center justify-center gap-2" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Export Training Report
            </button>
          </div>

        </div>
      </aside>

    </div><!-- End Dashboard Grid -->

    <!-- Legacy hidden elements preserved to prevent JS errors -->
    <div id="hidden-legacy-support" class="hidden">
      <button id="btn-quick-start">Quick</button>
      <button id="btn-start-sticky">Start</button>
      <button id="btn-pause-sticky">Pause</button>
      <button id="btn-step-sticky">Step</button>
      <button id="btn-reset-sticky">Reset</button>
      <div id="sidebar-sticky-footer"></div>
      <div id="training-fieldset"></div>
      <input type="file" id="input-load-model" />
      <input type="file" id="input-load-weights" />

      <!-- Mock elements for deprecated tab system if JS still queries them -->
      <button id="tab-btn-setup"></button>
      <button id="tab-btn-train"></button>
      <button id="tab-btn-analyse"></button>
      <div id="tab-setup"></div>
      <div id="tab-train"></div>
      <div id="tab-analyse"></div>

      <!-- Inputs that might be missing from the compact view -->
      <input type="checkbox" id="input-notifications" />
      <input type="checkbox" id="input-record-evolution" />
      <input type="range" id="input-point-size" value="5" />
      <input type="range" id="input-opacity" value="70" />
      <input type="range" id="input-contours" value="10" />
      <input type="checkbox" id="input-zoom" checked />
      <input type="checkbox" id="input-tooltips" checked />
      <input type="checkbox" id="input-highlight-errors" />
      <input type="checkbox" id="input-confidence-circles" />
      <input type="checkbox" id="input-show-grid" />
      <input type="checkbox" id="input-show-discretized" />
      <input type="checkbox" id="input-misclassified" />
      <input type="checkbox" id="input-confidence" />
      <!-- 3D container references -->
      <div id="three-container"> <button id="btn-3d-reset"></button> <button id="btn-3d-top"></button> <button
          id="btn-3d-side"></button> </div>

      <!-- Explanation stuff -->
      <button id="btn-explain-moment"></button>
      <div id="explain-moment-panel"> <button id="btn-close-explanation"></button>
        <div id="explain-message"></div>
        <div id="explain-tip"></div>
      </div>

      <div id="data-point-tooltip"><span id="tooltip-class"></span><span id="tooltip-confidence"></span><span
          id="tooltip-position"></span><span id="tooltip-true-label"></span><span id="tooltip-prediction"></span></div>

      <!-- Research buttons -->
      <button id="btn-lr-finder"></button>
      <button id="btn-feature-importance"></button>
      <button id="btn-lime-explain"></button>
      <button id="btn-saliency-map"></button>
      <button id="btn-adversarial"></button>
      <button id="btn-uncertainty"></button>
      <button id="btn-nas"></button>
      <button id="btn-ab-compare"></button>
      <button id="btn-ensemble"></button>
      <button id="btn-save-baseline"></button>
      <button id="btn-clear-baseline"></button>
      <div id="comparison-panel">
        <div id="comparison-diff"></div>
      </div>
      <div id="ab-comparison-panel"> <span id="ab-epoch-a"></span> <span id="ab-epoch-b"></span> <button
          id="btn-stop-ab"></button> </div>
      <div id="ensemble-panel"> <button id="btn-add-ensemble-member"></button> <button id="btn-train-ensemble"></button>
        <button id="btn-stop-ensemble"></button>
      </div>
    </div>

  </div> <!-- app-container -->

  <!-- HELP & ONBOARDING MODALS (Preserved) -->
  <div id="help-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4" role="dialog" aria-labelledby="help-title" aria-modal="true">
    <div class="bg-navy-800 rounded-xl border border-navy-600 shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
      <!-- Header -->
      <div class="flex items-center justify-between px-6 py-4 border-b border-navy-600">
        <h2 id="help-title" class="text-lg font-bold text-slate-200 flex items-center gap-2">
          <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Keyboard Shortcuts
        </h2>
        <button id="help-close" class="p-2 rounded hover:bg-navy-700 text-slate-400 hover:text-slate-200 transition-colors" aria-label="Close help">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Shortcuts List -->
      <div class="overflow-y-auto p-6 space-y-6">
        <!-- Training Controls -->
        <div>
          <h3 class="text-sm font-bold text-cyan-400 mb-3 uppercase tracking-wider">Training Controls</h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Start / Pause Training</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">Space</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Step One Epoch</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">S</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Reset Training</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">R</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Pause</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">Esc</kbd>
            </div>
          </div>
        </div>

        <!-- Configuration -->
        <div>
          <h3 class="text-sm font-bold text-cyan-400 mb-3 uppercase tracking-wider">Configuration</h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Undo Config Change</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">Ctrl + Z</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Redo Config Change</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">Ctrl + Y</kbd>
            </div>
          </div>
        </div>

        <!-- Datasets -->
        <div>
          <h3 class="text-sm font-bold text-cyan-400 mb-3 uppercase tracking-wider">Datasets</h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Circle Dataset</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">1</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">XOR Dataset</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">2</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Gaussian Dataset</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">3</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Spiral Dataset</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">4</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Moons Dataset</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">5</kbd>
            </div>
          </div>
        </div>

        <!-- View -->
        <div>
          <h3 class="text-sm font-bold text-cyan-400 mb-3 uppercase tracking-wider">View</h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Toggle Fullscreen</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">F</kbd>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-300 text-sm">Show This Help</span>
              <kbd class="px-2 py-1 bg-navy-900 border border-navy-600 rounded text-xs font-mono text-slate-400">?</kbd>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-6 py-4 border-t border-navy-600 bg-navy-900/50">
        <p class="text-xs text-slate-500 text-center">Press <kbd class="px-1 bg-navy-800 border border-navy-600 rounded text-slate-400">?</kbd> or <kbd class="px-1 bg-navy-800 border border-navy-600 rounded text-slate-400">Esc</kbd> to close</p>
      </div>
    </div>
  </div>

  <div id="onboarding-modal" class="hidden"></div>
  <div id="ab-modal" class="hidden"></div>

  <!-- TUTORIALS MODAL -->
  <div id="tutorials-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4" role="dialog" aria-labelledby="tutorials-title" aria-modal="true">
    <div class="bg-navy-800 rounded-xl border border-navy-600 shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between px-6 py-4 border-b border-navy-600">
        <h2 id="tutorials-title" class="text-lg font-bold text-slate-200 flex items-center gap-2">
          <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
          Guided Tutorials
        </h2>
        <button id="tutorials-close" class="p-2 rounded hover:bg-navy-700 text-slate-400 hover:text-slate-200 transition-colors" aria-label="Close tutorials">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div id="tutorials-list" class="overflow-y-auto p-6 space-y-4">
        <!-- Tutorials populated dynamically -->
      </div>
    </div>
  </div>

  <!-- CHALLENGES MODAL -->
  <div id="challenges-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4" role="dialog" aria-labelledby="challenges-title" aria-modal="true">
    <div class="bg-navy-800 rounded-xl border border-navy-600 shadow-2xl max-w-3xl w-full max-h-[85vh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between px-6 py-4 border-b border-navy-600">
        <h2 id="challenges-title" class="text-lg font-bold text-slate-200 flex items-center gap-2">
          <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
          </svg>
          Challenge Mode
        </h2>
        <div class="flex items-center gap-4">
          <div class="text-sm">
            <span class="text-slate-400">Total Points:</span>
            <span id="challenge-total-points" class="text-amber-400 font-bold ml-1">0</span>
          </div>
          <button id="challenges-close" class="p-2 rounded hover:bg-navy-700 text-slate-400 hover:text-slate-200 transition-colors" aria-label="Close challenges">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
      <div class="flex border-b border-navy-600">
        <button class="challenge-tab px-4 py-2 text-sm font-medium text-cyan-400 border-b-2 border-cyan-400" data-tab="challenges">Challenges</button>
        <button class="challenge-tab px-4 py-2 text-sm font-medium text-slate-400 hover:text-slate-300" data-tab="leaderboard">Leaderboard</button>
      </div>
      <div id="challenges-content" class="overflow-y-auto p-6">
        <div id="challenges-list" class="space-y-4">
          <!-- Challenges populated dynamically -->
        </div>
        <div id="leaderboard-content" class="hidden">
          <div id="leaderboard-list" class="space-y-2">
            <!-- Leaderboard populated dynamically -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ACTIVE CHALLENGE BANNER -->
  <div id="challenge-banner" class="fixed top-16 left-1/2 -translate-x-1/2 z-40 hidden">
    <div class="bg-amber-500/20 border border-amber-500/50 rounded-lg px-4 py-2 flex items-center gap-3 shadow-lg backdrop-blur">
      <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
      </svg>
      <div>
        <div class="text-xs text-amber-300 font-medium">Active Challenge</div>
        <div id="challenge-banner-name" class="text-sm text-white font-bold"></div>
      </div>
      <div id="challenge-banner-status" class="text-xs text-slate-300 ml-4"></div>
      <button id="challenge-banner-abandon" class="ml-4 text-xs text-slate-400 hover:text-red-400 transition-colors">
        Abandon
      </button>
    </div>
  </div>

  <!-- LEARN MENU BUTTON (in header) -->
  <!-- Note: This will be added to the header via JavaScript -->

  <!-- SCRIPT IMPORT -->
  <script type="module" src="/src/main.ts"></script>
</body>

</html>